import{c as O}from"./elements-7fef0fbb.js";import{ay as S,a1 as j,j as W,aA as T,aB as b,an as i,_ as D,F as G,e as P,m as V,q as A,w as h,U as n,P as o,p as r,N as M,Q as z,R as v}from"./index-c15ef0e4.js";import{c as Y}from"./shared-820eba90.js";import{A as L}from"./appType-b44f4066.js";const Z="background-image",F="lazy-loading",Q="lazy-error",E="lazy-attempt",$=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],p="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",l=[],d=[],x=Y(100),e={loading:p,error:p,attempt:3,throttleWait:300,events:$};let _=b(u,e.throttleWait);function m(t,a){t._lazy.arg===Z?t.style.backgroundImage=`url(${a})`:t.setAttribute("src",a)}function q(t){t._lazy.loading&&m(t,t._lazy.loading),u()}function H(t){t._lazy.error&&m(t,t._lazy.error),t._lazy.state="error",y(t),u()}function w(t,a){m(t,a),t._lazy.state="success",y(t),u()}function K(t){var a;d.includes(t)||(d.push(t),(a=e.events)==null||a.forEach(s=>{t.addEventListener(s,_,{passive:!0})}))}function X(){d.forEach(t=>{var a;(a=e.events)==null||a.forEach(s=>{t.removeEventListener(s,_)})}),d.length=0}function J(t,a){const s={loading:t.getAttribute(F)??e.loading,error:t.getAttribute(Q)??e.error,attempt:t.getAttribute(E)?Number(t.getAttribute(E)):e.attempt};t._lazy={src:a.value,arg:a.arg,currentAttempt:0,state:"pending",attemptLock:!1,...s},m(t,p),j(e.filter,t._lazy)}function tt(t,a){const s=new Image;s.src=a,t._lazy.preloadImage=s,s.addEventListener("load",()=>{t._lazy.attemptLock=!1,x.add(a),w(t,a)}),s.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?H(t):I(t)})}function I(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:a}=t._lazy;if(x.has(a)){w(t,a),t._lazy.attemptLock=!1;return}q(t),tt(t,a)}async function f(t){await W(),T(t)&&I(t)}function u(){l.forEach(t=>f(t))}async function at(t){!l.includes(t)&&l.push(t),O(t).forEach(K),await f(t)}function y(t){S(l,t),l.length===0&&X()}function et(t,a){const{src:s,arg:g}=t._lazy;return s!==a.value||g!==a.arg}async function N(t,a){J(t,a),await at(t)}async function st(t,a){if(!et(t,a)){l.includes(t)&&await f(t);return}await N(t,a)}function nt(t={}){const{events:a,loading:s,error:g,attempt:B,throttleWait:C,filter:R}=t;e.events=a??e.events,e.loading=s??e.loading,e.error=g??e.error,e.attempt=B??e.attempt,e.throttleWait=C??e.throttleWait,e.filter=R}const ot={mounted:N,unmounted:y,updated:st,install(t,a){nt(a),_=b(u,e.throttleWait),t.directive("lazy",this)}},c=ot,rt={basicUsage:"基本使用",backgroundImageLazyLoad:"背景图懒加载"},ct={basicUsage:"Basic Usage",backgroundImageLazyLoad:"Background Image Lazy Load"},{add:U,use:it,pack:k,packs:vt,merge:Lt}=i.useLocale(),lt=t=>{i.use(t),it(t)};i.add("zh-CN",i.zhCN);i.add("en-US",i.enUS);U("zh-CN",rt);U("en-US",ct);const ut={class:"lazy-example-cat"},dt={class:"lazy-example-cat"},mt={class:"lazy-example-cat"},gt={class:"lazy-example-cat"},pt={class:"lazy-example-cat"},_t={class:"lazy-example-cat"},ft={__name:"index",setup(t){return G(lt),(a,s)=>(P(),V(M,null,[A(n(L),null,{default:h(()=>[z(v(n(k).basicUsage),1)]),_:1}),o(r("img",ut,null,512),[[n(c),"https://varlet.gitee.io/varlet-ui/cat.jpg"]]),o(r("img",dt,null,512),[[n(c),"https://varlet.gitee.io/varlet-ui/cat.jpg"]]),o(r("img",mt,null,512),[[n(c),"https://varlet.gitee.io/varlet-ui/cat.jpg"]]),o(r("img",gt,null,512),[[n(c),"https://varlet.gitee.io/varlet-ui/cat.jpg"]]),o(r("img",pt,null,512),[[n(c),"https://varlet.gitee.io/varlet-ui/cat.jpg"]]),A(n(L),null,{default:h(()=>[z(v(n(k).backgroundImageLazyLoad),1)]),_:1}),o(r("div",_t,null,512),[[n(c),"https://varlet.gitee.io/varlet-ui/cat.jpg","background-image"]])],64))}},Et=D(ft,[["__scopeId","data-v-54c529f2"]]);export{Et as default};
